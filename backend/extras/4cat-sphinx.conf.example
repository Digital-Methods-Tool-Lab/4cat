## /* Data sources */
source 4cat {
    type = pgsql
    sql_host = localhost
    sql_user = fourcat
    sql_pass = supers3cr3t
    sql_db = fourcat
    sql_port = 5432
}

source 4cat_posts : 4cat {
    sql_query_range = SELECT MIN(id_seq), MAX(id_seq) FROM posts
    sql_range_step = 10000000

    sql_query = SELECT p.id_seq AS id, p.id AS post_id, p.thread_id, p.body, p.author, \
                       p.subject, p.timestamp, t.board \
                  FROM posts AS p \
             LEFT JOIN threads AS t \
                    ON p.thread_id = t.id \
                 WHERE p.id_seq >= $start AND p.id_seq <= $end

    sql_field_string = subject
    sql_attr_string = board
    sql_attr_string = author
    sql_attr_bigint = post_id
    sql_attr_bigint = thread_id
    sql_attr_timestamp = timestamp
}

source 4cat_threads : 4cat {
    sql_query = SELECT id_seq AS id, id AS thread_id, board, timestamp, timestamp_modified \
                  FROM threads
    sql_attr_timestamp = timestamp
    sql_attr_timestamp = timestamp_modified
    sql_attr_bigint = thread_id
}

## /* Indexes */
index 4cat_index {
    type = template
    morphology = lemmatize_en
    min_word_len = 3
    min_infix_len = 3
    charset_table = 0..9, a..z, _, A..Z->a..z, U+00C0->a, U+00C1->a, U+00C2->a, U+00C3->a, U+00C4->a, U+00C5->a, U+00C7->c,$
}

index 4cat_posts : 4cat_index {
    type = plain
    source = 4cat_posts
    path = 4cat-posts
    min_word_len = 3
    min_infix_len = 3
    stopwords = stopwords_en.lst
    html_strip = 1
}

index 4cat_threads : 4cat_index {
    type = plain
    source = 4cat_threads
    path = 4cat-threads
}

## /* Daemon configuration */
common {
    lemmatizer_base = /var/lib/
}

searchd {
    log = searchd.log
    query_log = searchd-queries.log
    pid_file = sphinx.pid
    listen = 127.0.0.1:9213
    listen = 127.0.0.1:9306:mysql41
}

indexer {
    mem_limit = 786M
}