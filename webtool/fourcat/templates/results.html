{% extends "layout.html" %}

{% block title %}Results &amp; previous queries{% endblock %}
{% block body_class %}result-list plain-page{% endblock %}

{% block body %}
    <article>
      <h2><span>Recent results</span></h2>
      <ol class="result-list">
      {% for query in queries %}{% if query.key_parent == "" %}
        <li id="{{ query.key }}" class="result{% if query.is_finished and query.num_rows > 0 %} has_results{% endif %}" data-numrows="{{ query.num_rows }}">
          <h3>
            <span class="property-badge">/{{ query.parameters.board }}/</span>
          {% if query.parameters.body_query and query.parameters.body_query != "empty" %}
              <span class="inline-label">body:</span> <span class="inline-query">{{ query.parameters.body_query }}</span>
          {% endif %}
          {% if query.parameters.subject_query and query.parameters.subject_query != "empty" %}
              <span class="inline-label">subject:</span> <span class="inline-query">{{ query.parameters.subject_query }}</span>
          {% endif %}
          {%  if query.parameters.full_thread %}
              <span class="property-badge second-tier">full thread</span>
          {% endif %}
          {%  if query.parameters.dense_threads %}
              <span class="property-badge second-tier">dense threads ({{ query.parameters.dense_percentage }}%)</span>
          {% endif %}
          {%  if query.is_finished and query.num_rows == 0 %}
              <span class="property-badge second-tier warning">no results</span>
          {% endif %}
          </h3>
          <div class="result-files">
        {% if query.is_finished %}
            {% if query.num_rows > 0 %}
            <p class="result-file">
              {{ query.num_rows }} posts;
              <a href="/result/{{ query.result_file }}">{{ query.result_file }}</a>
            </p>
            {% endif %}
        {% elif query.status %}
            <p>Currently executing query ({{ query.status }}).</p>
        {% else %}
            <p>Query is queued.</p>
        {% endif %}
        {% if query.is_finished and query.subqueries|length > 0 %}
            <ol class="subquery-list">
            {% for subquery in query.subqueries %}
                <li id="subquery-{{ subquery.key }}">{{ subquery.postprocessor.name }} ({% if subquery.is_finished %}<a href="/result/{{ subquery.result_file }}">{% if subquery.num_rows > 0 %}{{ subquery.num_rows }} items, {% endif %}{{ subquery.postprocessor.extension }}</a>{% elif subquery.status == "" %}Queued{% else %}Running - {{ subquery.status }}{% endif %})</li>
            {% endfor %}
            </ol>
        {% endif %}
          </div>
        </li>
      {% endif %}{% endfor %}
      </ol>
    </article>
{% endblock %}