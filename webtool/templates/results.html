{% extends "layout.html" %}

{% block title %}Results &amp; previous queries{% endblock %}
{% block body_class %}result-list plain-page{% endblock %}

{% block body %}
    <nav class="view-controls">
    <form action="" method="GET">
    <ul>
        <li><label><input type="checkbox" id="all-results" name="all_results"{% if filter.all_results %} checked="checked"{% endif %} #}> Show all results, not just my own</label></li>
        <li><input aria-label="Query filter" placeholder="Filter queries..." name="filter" value="{{ filter.filter }}"></li>
    </ul>
    <button>Update</button>
    </form>
    </nav>
    <article>
      <h2><span>Recent results</span></h2>
      <ol class="result-list">
      {% for dataset in queries %}{% if dataset.key_parent == "" %}
        <li id="{{ dataset.key }}" class="result{% if dataset.is_finished and dataset.num_rows > 0 %} has_results{% endif %}" data-numrows="{{ dataset.num_rows }}">
          <h3>
            <a href="/results/{{ dataset.key }}/">#</a>
             <span class="property-badge">{{ dataset.parameters.datasource if "datasource" in dataset.parameters else "4chan" }}/{{ dataset.parameters.board }}/</span>
          {% if dataset.parameters.body_query and dataset.parameters.body_query != "empty" %}
              <span class="inline-label">body:</span> <span class="inline-query">{{ dataset.parameters.body_query }}</span>
          {% endif %}
          {% if dataset.parameters.subject_query and dataset.parameters.subject_query != "empty" %}
              <span class="inline-label">subject:</span> <span class="inline-query">{{ dataset.parameters.subject_query }}</span>
          {% endif %}
          {% if dataset.parameters.country_flag and dataset.parameters.country_flag != "all" %}
              <span class="inline-label">country:</span>
              <span class="inline-query">{{ dataset.parameters.country_flag }}</span>
          {% endif %}
          {% if dataset.parameters.url %}
              <span class="inline-label">URL:</span>
              <span class="inline-query">{{ dataset.parameters.url }}</span>
          {% endif %}
          {% if dataset.parameters.full_thread %}
              <span class="property-badge second-tier">full thread</span>
          {% endif %}
          {% if dataset.parameters.random_amount and dataset.parameters.random_amount > 0 %}
              <span class="property-badge second-tier">random sample={{ dataset.parameters.random_amount }}</span>
          {% endif %}
          {%  if dataset.parameters.dense_threads %}
              <span class="property-badge second-tier">dense threads ({{ dataset.parameters.dense_percentage }}%)</span>
          {% endif %}
          {% if dataset.parameters.dense_country_percentage %}
              <span class="property-badge second-tier">country-dense threads ({{ dataset.parameters.dense_country_percentage }}%)</span>
          {% endif %}
          {%  if dataset.is_finished and dataset.num_rows == 0 %}
              <span class="property-badge second-tier warning">no results</span>
          {% endif %}
          {% if dataset.parameters.min_date > 0 %}
              <span class="property-badge">From</span>
              <span class="inline-query">{{ dataset.parameters.min_date|datetime }}</span>
          {% endif %}{% if dataset.parameters.max_date > 0 %}
              <span class="property-badge">Until</span>
              <span class="inline-query">{{ dataset.parameters.max_date|datetime }}</span>
          {% endif %}
          </h3>

          <div class="result-files">
        {% if dataset.is_finished %}
            <p class="result-file">
              {{ dataset.num_rows }} posts;
              {% if dataset.num_rows > 0 %}
                <a href="/result/{{ dataset.result_file }}">{{ dataset.result_file }}</a>
              {% endif %}
            </p>
        {% elif dataset.status %}
            <p>Currently executing query ({{ dataset.status }}).</p>
        {% else %}
            <p>Query is queued.</p>
        {% endif %}
        {% if dataset.is_finished and dataset.children|length > 0 %}
            <ol class="child-list">
                <li><a href="/results/{{ dataset.key }}/">{{ dataset.children|length }} analysis result{% if dataset.childrenf|length != 1 %}s{% endif %} available</a></li>
            </ol>
        {% endif %}

          </div>
          {% if dataset.num_rows > 0 %}
              <div><a class="button-like processor-link" href="/results/{{ dataset.key }}/">Analysis</a></div>
              {% endif %}
        </li>
      {% endif %}{% endfor %}
      </ol>
    </article>

    <nav class="pagination">
      <ol>
      {% if pagination.has_prev %}
        <li><a href="/results/page/{{ pagination.page - 1 }}/?{{ filter|http_query }}">&laquo; Previous</a></li>
      {% endif %}
      {%- for page in pagination.iter_pages() %}
        {% if page %}
          {% if page != pagination.page %}
            <li class="page"><a href="/results/page/{{ page }}/?{{ filter|http_query }}">{{ page }}</a></li>
          {% else %}
            <li class="page"><strong class="current">{{ page }}</strong></li>
          {% endif %}
        {% else %}
          <li class="ellipsis">â€¦</li>
        {% endif %}
      {%- endfor %}
      {% if pagination.has_next %}
        <li><a href="/results/page/{{ pagination.page + 1 }}/?{{ filter|http_query }}">Next &raquo;</a></li>
      {% endif %}
      </ol>
      </nav>
{% endblock %}